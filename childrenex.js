const comments = [
  {
    path: ["599", "x9gy45zkc2xyj10"],
    id: "x9gy45zkc2xyj10",
    author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
    author_username: "ivanrl",
    content: ["<p>Parent comment</p>"],
    post_id: 599,
    comment_id: null,
    createdAt: "2020-07-01T05:50:40.598Z",
    updatedAt: "2020-07-01T05:50:40.598Z",
    user_vote: 0,
    voteValue: 0,
    replies: [
      {
        path: ["599", "x9gy45zkc2xyj10", "x9gy45zkc2xyw6j"],
        id: "x9gy45zkc2xyw6j",
        author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
        author_username: "ivanrl",
        content: ["<p>first reply</p>"],
        post_id: null,
        comment_id: "x9gy45zkc2xyj10",
        createdAt: "2020-07-01T05:50:57.643Z",
        updatedAt: "2020-07-01T05:50:57.643Z",
        user_vote: 0,
        voteValue: 0,
        replies: [
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xyw6j",
              "x9gy45zkc2z19iz",
            ],
            id: "x9gy45zkc2z19iz",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>pls</p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xyw6j",
            createdAt: "2020-07-01T06:20:47.867Z",
            updatedAt: "2020-07-01T06:20:47.867Z",
            user_vote: 0,
            voteValue: 0,
            replies: [],
          },
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xyw6j",
              "xciex5kc3vkq1b",
            ],
            id: "xciex5kc3vkq1b",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>this one works</p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xyw6j",
            createdAt: "2020-07-01T21:31:43.439Z",
            updatedAt: "2020-07-01T21:31:43.439Z",
            user_vote: 0,
            voteValue: 0,
            replies: [],
          },
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xyw6j",
              "xciex5kc3w8ct5",
            ],
            id: "xciex5kc3w8ct5",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>dude</p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xyw6j",
            createdAt: "2020-07-01T21:50:06.042Z",
            updatedAt: "2020-07-01T21:50:06.042Z",
            user_vote: 0,
            voteValue: 0,
            replies: [
              {
                path: [
                  "599",
                  "x9gy45zkc2xyj10",
                  "x9gy45zkc2xyw6j",
                  "xciex5kc3w8ct5",
                  "xciex5kc3w8hqj",
                ],
                id: "xciex5kc3w8hqj",
                author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
                author_username: "ivanrl",
                content: ["<p>does it</p>"],
                post_id: null,
                comment_id: "xciex5kc3w8ct5",
                createdAt: "2020-07-01T21:50:12.427Z",
                updatedAt: "2020-07-01T21:50:12.427Z",
                user_vote: 0,
                voteValue: 0,
                replies: [],
              },
            ],
          },
        ],
      },
      {
        path: ["599", "x9gy45zkc2xyj10", "x9gy45zkc2xz349"],
        id: "x9gy45zkc2xz349",
        author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
        author_username: "ivanrl",
        content: ["<p>second reply</p>"],
        post_id: null,
        comment_id: "x9gy45zkc2xyj10",
        createdAt: "2020-07-01T05:51:06.634Z",
        updatedAt: "2020-07-01T05:51:06.634Z",
        user_vote: 0,
        voteValue: 0,
        replies: [
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xz349",
              "x9gy45zkc2z1hgu",
            ],
            id: "x9gy45zkc2z1hgu",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>pls2</p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xz349",
            createdAt: "2020-07-01T06:20:58.158Z",
            updatedAt: "2020-07-01T06:20:58.158Z",
            user_vote: 0,
            voteValue: 0,
            replies: [
              {
                path: [
                  "599",
                  "x9gy45zkc2xyj10",
                  "x9gy45zkc2xz349",
                  "x9gy45zkc2z1hgu",
                  "xciex5kc3w8zxx",
                ],
                id: "xciex5kc3w8zxx",
                author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
                author_username: "ivanrl",
                content: ["<p>no? really?</p>"],
                post_id: null,
                comment_id: "x9gy45zkc2z1hgu",
                createdAt: "2020-07-01T21:50:36.021Z",
                updatedAt: "2020-07-01T21:50:36.021Z",
                user_vote: 0,
                voteValue: 0,
                replies: [],
              },
            ],
          },
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xz349",
              "x9gy45zkc2z1j5y",
            ],
            id: "x9gy45zkc2z1j5y",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>pls2</p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xz349",
            createdAt: "2020-07-01T06:21:00.358Z",
            updatedAt: "2020-07-01T06:21:00.358Z",
            user_vote: 0,
            voteValue: 0,
            replies: [
              {
                path: [
                  "599",
                  "x9gy45zkc2xyj10",
                  "x9gy45zkc2xz349",
                  "x9gy45zkc2z1j5y",
                  "xciex5kc3w8p7j",
                ],
                id: "xciex5kc3w8p7j",
                author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
                author_username: "ivanrl",
                content: ["<p>yeah</p>"],
                post_id: null,
                comment_id: "x9gy45zkc2z1j5y",
                createdAt: "2020-07-01T21:50:22.111Z",
                updatedAt: "2020-07-01T21:50:22.111Z",
                user_vote: 0,
                voteValue: 0,
                replies: [],
              },
            ],
          },
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xz349",
              "xciex5kc3w9g5h",
            ],
            id: "xciex5kc3w9g5h",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>here? </p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xz349",
            createdAt: "2020-07-01T21:50:57.029Z",
            updatedAt: "2020-07-01T21:50:57.029Z",
            user_vote: 0,
            voteValue: 0,
            replies: [
              {
                path: [
                  "599",
                  "x9gy45zkc2xyj10",
                  "x9gy45zkc2xz349",
                  "xciex5kc3w9g5h",
                  "xciex5kc3w9li5",
                ],
                id: "xciex5kc3w9li5",
                author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
                author_username: "ivanrl",
                content: ["<p>here? </p>"],
                post_id: null,
                comment_id: "xciex5kc3w9g5h",
                createdAt: "2020-07-01T21:51:03.965Z",
                updatedAt: "2020-07-01T21:51:03.965Z",
                user_vote: 0,
                voteValue: 0,
                replies: [],
              },
              {
                path: [
                  "599",
                  "x9gy45zkc2xyj10",
                  "x9gy45zkc2xz349",
                  "xciex5kc3w9g5h",
                  "xciex5kc3waj7g",
                ],
                id: "xciex5kc3waj7g",
                author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
                author_username: "ivanrl",
                content: ["<p>here? </p>"],
                post_id: null,
                comment_id: "xciex5kc3w9g5h",
                createdAt: "2020-07-01T21:51:47.645Z",
                updatedAt: "2020-07-01T21:51:47.645Z",
                user_vote: 0,
                voteValue: 0,
                replies: [],
              },
            ],
          },
        ],
      },
      {
        path: ["599", "x9gy45zkc2xyj10", "x9gy45zkc2xzakk"],
        id: "x9gy45zkc2xzakk",
        author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
        author_username: "ivanrl",
        content: ["<p>third reply</p>"],
        post_id: null,
        comment_id: "x9gy45zkc2xyj10",
        createdAt: "2020-07-01T05:51:16.292Z",
        updatedAt: "2020-07-01T05:51:16.292Z",
        user_vote: 0,
        voteValue: 0,
        replies: [
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xzakk",
              "x9gy45zkc2z1vte",
            ],
            id: "x9gy45zkc2z1vte",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>adadadasd</p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xzakk",
            createdAt: "2020-07-01T06:21:16.754Z",
            updatedAt: "2020-07-01T06:21:16.754Z",
            user_vote: 0,
            voteValue: 0,
            replies: [],
          },
          {
            path: [
              "599",
              "x9gy45zkc2xyj10",
              "x9gy45zkc2xzakk",
              "xciex5kc3waav0",
            ],
            id: "xciex5kc3waav0",
            author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
            author_username: "ivanrl",
            content: ["<p>aaa</p>"],
            post_id: null,
            comment_id: "x9gy45zkc2xzakk",
            createdAt: "2020-07-01T21:51:36.828Z",
            updatedAt: "2020-07-01T21:51:36.828Z",
            user_vote: 0,
            voteValue: 0,
            replies: [],
          },
        ],
      },
    ],
  },
];

const insterIntoTree = (
  newComment,
  commentsArray,
  pathLength,
  idxPath,
  firstTry = true
) => {
  if (firstTry) {
    let currentBranch = commentsArray;
    /*
    idxPath.forEach((idx) => {
      currentBranch = currentBranch[idx];
    }); */

    for (let i = 0; i < currentBranch.length; i++) {
      if (currentBranch[i].path[1] === newComment.path[1]) {
        currentBranch[i].replies.push(newComment);
        return commentsArray;
      } else if (
        currentBranch[i].path.includes(newComment.path[pathLength - 1])
      ) {
        idxPath.push(i);
        return insterIntoTree(
          newComment,
          commentsArray,
          pathLength + 1,
          idxPath,
          false
        );
      }
    }
  } else {
    let currentBranch = commentsArray[idxPath[0]];
    for (let j = 1; j < idxPath.length; j++) {
      currentBranch = currentBranch.replies[idxPath[j]];
    }

    for (let i = 0; i < currentBranch.replies.length; i++) {
      if (
        currentBranch.replies[i].path.includes(newComment.path[pathLength - 2])
      ) {
        if (
          currentBranch.replies[i].path.length + 1 ===
          newComment.path.length
        ) {
          if (
            currentBranch.replies[i].path[
              currentBranch.replies[i].path.length - 1
            ] === newComment.path[newComment.path.length - 2]
          ) {
            currentBranch.replies[i].replies.push(newComment);
            return commentsArray;
          } else {
            continue;
          }
        } else if (
          currentBranch.replies[i].path[
            currentBranch.replies[i].path.length - 1
          ] === newComment.path[currentBranch.replies[i].path.length - 1]
        ) {
          idxPath.push(i);
          return insterIntoTree(
            newComment,
            commentsArray,
            pathLength + 1,
            idxPath,
            false
          );
        } else {
          continue;
        }
      }
    }
  }
  return commentsArray;
};

const newComment = {
  path: ["599", "x9gy45zkc2xyj10", "x9gy45zkc2xzjjh"],
  id: "x9gy45zkc2xzjjh",
  author_id: "d20dab92-03b8-4876-8b02-60f62240c58a",
  author_username: "ivanrl",
  content: ["<p>s</p>"],
  post_id: null,
  comment_id: "x9gy45zkc2xyj10",
  createdAt: "2020-07-01T21:51:52.241Z",
  updatedAt: "2020-07-01T21:51:52.241Z",
  user_vote: 0,
  voteValue: 0,
  replies: [],
};

const a = insterIntoTree(newComment, comments, 2, []);
console.log(a);
